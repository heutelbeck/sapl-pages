

<!DOCTYPE html>

<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">

  <link rel="stylesheet" href="/docs/3.0.0-SNAPSHOT-MD/saplReference/assets/css/just-the-docs-default.css">

  <link rel="stylesheet" href="/docs/3.0.0-SNAPSHOT-MD/saplReference/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet">

  <style id="jtd-nav-activation">
  

.site-nav > ul.nav-list:first-child > li > a,
.site-nav > ul.nav-list:first-child > li > ul > li > a,
.site-nav > ul.nav-list:first-child > li > ul > li > ul > li:not(:nth-child(7)) > a {
  background-image: none;
}

.site-nav > ul.nav-list:not(:first-child) a,
.site-nav li.external a {
  background-image: none;
}

.site-nav > ul.nav-list:first-child > li:nth-child(1) > ul > li:nth-child(5) > ul > li:nth-child(7) > a {
  font-weight: 600;
  text-decoration: none;
}.site-nav > ul.nav-list:first-child > li:nth-child(1) > button svg,
.site-nav > ul.nav-list:first-child > li:nth-child(1) > ul > li:nth-child(5) > button svg {
  transform: rotate(-90deg);
}.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(1) > ul.nav-list,
.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(1) > ul.nav-list > li.nav-list-item:nth-child(5) > ul.nav-list {
  display: block;
}
  </style>

  

  
    <script src="/docs/3.0.0-SNAPSHOT-MD/saplReference/assets/js/vendor/lunr.min.js"></script>
  

  <script src="/docs/3.0.0-SNAPSHOT-MD/saplReference/assets/js/just-the-docs.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1">

  

  <link rel="icon" href="/docs/3.0.0-SNAPSHOT-MD/saplReference/assets/sapl_reference_images/favicon.png" type="image/x-icon">



  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>SAPL Expressions | SAPL</title>
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="SAPL Expressions" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="SAPL is a powerful policy language and engine to implement Attribute-based access control (ABAC). It comes with developement tools for testing, authorization servers, authoring tools. Framework integrations are available for Spring, Axon, and Vaadin to provide flexible policy enforcement points (PEPs) in your application." />
<meta property="og:description" content="SAPL is a powerful policy language and engine to implement Attribute-based access control (ABAC). It comes with developement tools for testing, authorization servers, authoring tools. Framework integrations are available for Spring, Axon, and Vaadin to provide flexible policy enforcement points (PEPs) in your application." />
<link rel="canonical" href="/docs/3.0.0-SNAPSHOT-MD/saplReference/reference/SAPL-Expressions/" />
<meta property="og:url" content="/docs/3.0.0-SNAPSHOT-MD/saplReference/reference/SAPL-Expressions/" />
<meta property="og:site_name" content="SAPL" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="SAPL Expressions" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"SAPL is a powerful policy language and engine to implement Attribute-based access control (ABAC). It comes with developement tools for testing, authorization servers, authoring tools. Framework integrations are available for Spring, Axon, and Vaadin to provide flexible policy enforcement points (PEPs) in your application.","headline":"SAPL Expressions","url":"/docs/3.0.0-SNAPSHOT-MD/saplReference/reference/SAPL-Expressions/"}</script>
<!-- End Jekyll SEO tag -->


  <link rel="icon" href="/assets/sapl_reference_images/favicon.png" type="image/png">
<!-- Matomo -->
<script type="text/javascript">
    var _paq = window._paq || [];    
    _paq.push(["disableCookies"]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
        var u="//www.ftk.de/statistik/";
        _paq.push(['setTrackerUrl', u+'matomo.php']);
        _paq.push(['setSiteId', '2']);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
        g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
    })();
</script>
<!-- End Matomo Code -->


</head>

<body>
  <a class="skip-to-main" href="#main-content">Skip to main content</a>
  <svg xmlns="http://www.w3.org/2000/svg" class="d-none">
  <symbol id="svg-link" viewBox="0 0 24 24">
  <title>Link</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link">
    <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
  </svg>
</symbol>

  <symbol id="svg-menu" viewBox="0 0 24 24">
  <title>Menu</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu">
    <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line>
  </svg>
</symbol>

  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
  <title>Expand</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right">
    <polyline points="9 18 15 12 9 6"></polyline>
  </svg>
</symbol>

  <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE -->
<symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link">
  <title id="svg-external-link-title">(external link)</title>
  <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line>
</symbol>

  
    <symbol id="svg-doc" viewBox="0 0 24 24">
  <title>Document</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file">
    <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline>
  </svg>
</symbol>

    <symbol id="svg-search" viewBox="0 0 24 24">
  <title>Search</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search">
    <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
  </svg>
</symbol>

  
  
    <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md -->
<symbol id="svg-copy" viewBox="0 0 16 16">
  <title>Copy</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16">
    <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
    <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/>
  </svg>
</symbol>
<symbol id="svg-copied" viewBox="0 0 16 16">
  <title>Copied</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16">
    <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/>
    <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/>
  </svg>
</symbol>

  
</svg>

  <div class="side-bar">
  <div class="site-header" role="banner">
    <a href="https://sapl.io/" class="site-title lh-tight">
  return to SAPL.io

</a>
    <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false">
      <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg>
    </button>
  </div>

  <nav aria-label="Main" id="site-nav" class="site-nav">
  
  
    <ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in SAPL Reference category" aria-pressed="false">
      <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
    </button><a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/" class="nav-list-link">SAPL Reference</a><ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Introduction category" aria-pressed="false">
            <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
          </button><a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/docs/SAPL_Reference/1_1_Introduction/" class="nav-list-link">Introduction</a><ul class="nav-list"><li class="nav-list-item">
                <a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/reference/Authorization-Subscriptions/" class="nav-list-link">Authorization Subscriptions</a>
              </li><li class="nav-list-item">
                <a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/reference/Structure-of-a-SAPL-Policy/" class="nav-list-link">Structure of a SAPL Policy</a>
              </li><li class="nav-list-item">
                <a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/reference/Authorization-Decisions/" class="nav-list-link">Authorization Decisions</a>
              </li><li class="nav-list-item">
                <a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/reference/Accessing-Attributes/" class="nav-list-link">Accessing Attributes</a>
              </li><li class="nav-list-item">
                <a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/reference/Getting-Started/" class="nav-list-link">Getting Started</a>
              </li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Reference Architecture category" aria-pressed="false">
            <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
          </button><a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/docs/SAPL_Reference/2_1_ReferenceArchitecture/" class="nav-list-link">Reference Architecture</a><ul class="nav-list"><li class="nav-list-item">
                <a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/reference/pep/" class="nav-list-link">PEP</a>
              </li><li class="nav-list-item">
                <a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/reference/pdp/" class="nav-list-link">PDP</a>
              </li><li class="nav-list-item">
                <a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/reference/pap/" class="nav-list-link">PAP</a>
              </li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Publish/Subscribe Protocol category" aria-pressed="false">
            <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
          </button><a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/docs/SAPL_Reference/3_1_PublishSubscribeProtocol/" class="nav-list-link">Publish/Subscribe Protocol</a><ul class="nav-list"><li class="nav-list-item">
                <a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/reference/SAPL-Authorization-Subscription/" class="nav-list-link">SAPL Authorization Subscription</a>
              </li><li class="nav-list-item">
                <a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/reference/SAPL-Authorization-Decision/" class="nav-list-link">SAPL Authorization Decision</a>
              </li><li class="nav-list-item">
                <a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/reference/Policy-Evaluation/" class="nav-list-link">Policy Evaluation</a>
              </li><li class="nav-list-item">
                <a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/reference/Multi-Subscriptions/" class="nav-list-link">Multi Subscriptions</a>
              </li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in PDP APIs category" aria-pressed="false">
            <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
          </button><a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/docs/SAPL_Reference/4_1_PDPAPIs/" class="nav-list-link">PDP APIs</a><ul class="nav-list"><li class="nav-list-item">
                <a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/reference/HTTP-Server-Sent-Events-API/" class="nav-list-link">HTTP Server-Sent Events API</a>
              </li><li class="nav-list-item">
                <a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/reference/Java-API/" class="nav-list-link">Java API</a>
              </li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in The SAPL Policy Language category" aria-pressed="false">
            <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
          </button><a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/docs/SAPL_Reference/5_1_TheSAPLPolicyLanguage/" class="nav-list-link">The SAPL Policy Language</a><ul class="nav-list"><li class="nav-list-item">
                <a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/reference/Overview/" class="nav-list-link">Overview</a>
              </li><li class="nav-list-item">
                <a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/reference/Imports/" class="nav-list-link">Imports</a>
              </li><li class="nav-list-item">
                <a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/reference/Schemas/" class="nav-list-link">Schemas</a>
              </li><li class="nav-list-item">
                <a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/reference/SAPL-Policy/" class="nav-list-link">SAPL Policy</a>
              </li><li class="nav-list-item">
                <a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/reference/SAPL-Policy-Set/" class="nav-list-link">SAPL Policy Set</a>
              </li><li class="nav-list-item">
                <a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/reference/Language-Elements/" class="nav-list-link">Language Elements</a>
              </li><li class="nav-list-item">
                <a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/reference/SAPL-Expressions/" class="nav-list-link">SAPL Expressions</a>
              </li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Authorization Subscription Evaluation category" aria-pressed="false">
            <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
          </button><a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/docs/SAPL_Reference/6_1_AuthorizationSubscriptionEvaluation/" class="nav-list-link">Authorization Subscription Evaluation</a><ul class="nav-list"><li class="nav-list-item">
                <a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/reference/Policy/" class="nav-list-link">Policy</a>
              </li><li class="nav-list-item">
                <a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/reference/Policy-Set/" class="nav-list-link">Policy Set</a>
              </li><li class="nav-list-item">
                <a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/reference/Authorization-Subscription/" class="nav-list-link">Authorization Subscription</a>
              </li><li class="nav-list-item">
                <a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/reference/Combining-Algorithm/" class="nav-list-link">Combining Algorithm</a>
              </li><li class="nav-list-item">
                <a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/reference/Transformation/" class="nav-list-link">Transformation</a>
              </li><li class="nav-list-item">
                <a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/reference/Obligation-Advice/" class="nav-list-link">Obligation / Advice</a>
              </li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Functions category" aria-pressed="false">
            <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
          </button><a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/docs/SAPL_Reference/7_1_Functions/" class="nav-list-link">Functions</a><ul class="nav-list"><li class="nav-list-item">
                <a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/reference/Custom-Function-Libraries/" class="nav-list-link">Custom Function Libraries</a>
              </li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Attribute Finders category" aria-pressed="false">
            <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
          </button><a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/docs/SAPL_Reference/8_1_AttributeFinders/" class="nav-list-link">Attribute Finders</a><ul class="nav-list"><li class="nav-list-item">
                <a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/reference/Custom-Attribute-Finders/" class="nav-list-link">Custom Attribute Finders</a>
              </li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Testing SAPL policies category" aria-pressed="false">
            <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
          </button><a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/docs/SAPL_Reference/9_1_TestingSAPLpolicies/" class="nav-list-link">Testing SAPL policies</a><ul class="nav-list"><li class="nav-list-item">
                <a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/reference/Usage-scenarios/" class="nav-list-link">Usage scenarios</a>
              </li><li class="nav-list-item">
                <a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/reference/Embedded-PDP/" class="nav-list-link">Embedded PDP</a>
              </li><li class="nav-list-item">
                <a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/reference/SAPL-Server/" class="nav-list-link">SAPL Server</a>
              </li><li class="nav-list-item">
                <a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/reference/Unit-Tests/" class="nav-list-link">Unit-Tests</a>
              </li><li class="nav-list-item">
                <a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/reference/Policy-Integration-Tests/" class="nav-list-link">Policy-Integration-Tests</a>
              </li><li class="nav-list-item">
                <a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/reference/Writing-test-cases/" class="nav-list-link">Writing test cases</a>
              </li><li class="nav-list-item">
                <a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/reference/Code-Coverage-Reports-via-the-SAPL-Maven-Plugin/" class="nav-list-link">Code Coverage Reports via the SAPL Maven Plugin</a>
              </li></ul></li></ul></li></ul>

  <ul class="nav-list"><li class="nav-list-item external">
          <a href="https://github.com/heutelbeck/sapl-policy-engine" class="nav-list-link external"
            
          >
            SAPL on GitHub
            <svg viewBox="0 0 24 24" aria-labelledby="svg-external-link-title"><use xlink:href="#svg-external-link"></use></svg>
          </a>
        </li></ul>
</nav>


  
  
    <br>

  
</div>

  <div class="main" id="top">
    <div id="main-header" class="main-header">
  
    

<div class="search" role="search">
  <div class="search-input-wrap">
    <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search SAPL" aria-label="Search SAPL" autocomplete="off">
    <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label>
  </div>
  <div id="search-results" class="search-results"></div>
</div>

  
  
  
    <nav aria-label="Auxiliary" class="aux-nav">
  <ul class="aux-nav-list">
    
      <li class="aux-nav-list-item">
        <a href="https://github.com/heutelbeck/sapl-policy-engine" class="site-button"
          
        >
          SAPL on GitHub
        </a>
      </li>
    
  </ul>
</nav>

  
</div>

    <div class="main-content-wrap">
      <nav aria-label="Breadcrumb" class="breadcrumb-nav">
  <ol class="breadcrumb-nav-list">
  
    <li class="breadcrumb-nav-list-item"><a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/">SAPL Reference</a></li>
    <li class="breadcrumb-nav-list-item"><a href="/docs/3.0.0-SNAPSHOT-MD/saplReference/docs/SAPL_Reference/5_1_TheSAPLPolicyLanguage/">The SAPL Policy Language</a></li>
  <li class="breadcrumb-nav-list-item"><span>SAPL Expressions</span></li>
  </ol>
</nav>
      <div id="main-content" class="main-content">
        <main>
          
            <h3 id="sapl-expressions">
  
  
    <a href="#sapl-expressions" class="anchor-heading" aria-labelledby="sapl-expressions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> SAPL Expressions
  
  
</h3>
    

<p>To ensure flexibility, various parts of a policy can be <strong>expressions</strong> that are evaluated at runtime. E.g., a policy’s target must be an expression evaluating to <code class="language-plaintext highlighter-rouge">true</code> or <code class="language-plaintext highlighter-rouge">false</code>. SAPL contains a uniform expression language that offers various useful features while still being easy to read and write.</p>

<p>Since JSON is the base data model, each expression evaluates to a JSON data type. These data types and the expression syntax are described in this section.</p>
<h4 id="json-data-types">
  
  
    <a href="#json-data-types" class="anchor-heading" aria-labelledby="json-data-types"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> JSON Data Types
  
  
</h4>
    

<p>SAPL is based on the <strong>JavaScript Object Notation</strong> or <strong>JSON</strong>, an <a href="http://www.ecma-international.org/publications/files/ECMA-ST/ECMA-404.pdf">ECMA Standard</a> for the representation of structured data. Any value occurring within the SAPL language is a JSON data type, and any expression within a policy evaluates to a JSON data type. The types and their JSON notations are:</p>

<ul>
  <li>Primitive Types
    <ul>
      <li><strong>Number</strong>: A signed decimal number, e.g., <code class="language-plaintext highlighter-rouge">-1.9</code>. There is no distinction between integer and floating-point numbers. In case an integer is expected (e.g., for a numeric index), the decimal number is rounded to an integer number.</li>
      <li><strong>String</strong>: A sequence of zero or more characters, written in double or single quotes, e.g., <code class="language-plaintext highlighter-rouge">"a string"</code> or <code class="language-plaintext highlighter-rouge">'a string'</code>.</li>
      <li><strong>Boolean</strong>: Either <code class="language-plaintext highlighter-rouge">true</code> or <code class="language-plaintext highlighter-rouge">false</code>.</li>
      <li><strong>null</strong>: Marks an empty value, <code class="language-plaintext highlighter-rouge">null</code>.</li>
    </ul>
  </li>
  <li>Structured Types
    <ul>
      <li>
        <p><strong>Object</strong>: An unordered set of name/value pairs. The name is a string. The value must be one of the available data types. It can also be an object itself. The name/value pair is also called an attribute of the object. E.g.</p>

        <p>{ “firstAttribute” : “first value”, “secondAttribute” : 123 }</p>
      </li>
      <li>
        <p><strong>Array</strong>: An ordered sequence of zero or more values of any JSON data type. E.g.</p>

        <p>[ “A value”, 123, {“attribute” : “value”} ]</p>
      </li>
    </ul>
  </li>
</ul>
<h4 id="expression-types">
  
  
    <a href="#expression-types" class="anchor-heading" aria-labelledby="expression-types"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Expression Types
  
  
</h4>
    

<p>SAPL knows <strong>basic expressions</strong> and <strong>operator expressions</strong> (created from other expressions using operators).</p>

<p>A <strong>basic expression</strong> is either a</p>

<ul>
  <li><strong>Value Expression</strong>: a value explicitly defined in the corresponding JSON notation (e.g., <code class="language-plaintext highlighter-rouge">"a value"</code>)</li>
  <li><strong>Identifier Expression</strong>: the name of a variable or of an authorization subscription attribute (<code class="language-plaintext highlighter-rouge">subject</code>, <code class="language-plaintext highlighter-rouge">resource</code>, <code class="language-plaintext highlighter-rouge">action</code>, or <code class="language-plaintext highlighter-rouge">environment</code>)</li>
  <li><strong>Function Expression</strong>: a function call (e.g., <code class="language-plaintext highlighter-rouge">simple.get_minimum(resource.array)</code>)</li>
  <li><strong>Relative Expression</strong>: <code class="language-plaintext highlighter-rouge">@</code>, which refers to a certain value depending on the context</li>
  <li><strong>Grouped Expression</strong>: any expression enclosed in parentheses, e.g., <code class="language-plaintext highlighter-rouge">(1 + 1)</code></li>
</ul>

<p>Each of these basic expressions can contain one or more <strong>selection steps</strong> (e.g., <code class="language-plaintext highlighter-rouge">subject.name</code>, which is the identifier expression <code class="language-plaintext highlighter-rouge">subject</code> followed by the selection step <code class="language-plaintext highlighter-rouge">.name</code> selecting the value of the <code class="language-plaintext highlighter-rouge">name</code> attribute). Additionally, a basic expression can contain a <strong>filter component</strong> (<code class="language-plaintext highlighter-rouge">|- Filter</code>) which will be applied to the evaluation result. If the expression evaluates to an array, instead of applying a filter, each item can be transformed using a <strong>subtemplate component</strong> (<code class="language-plaintext highlighter-rouge">:: Subtemplate</code>).</p>

<p><strong>Operator expressions</strong> can be constructed using prefix or infix <strong>operators</strong> (e.g., <code class="language-plaintext highlighter-rouge">1 + subject.age</code> or <code class="language-plaintext highlighter-rouge">! subject.isBlocked</code>). SAPL supports infix and prefix operators. They may be applied in connection with any expression. An operator expression within parentheses (e.g., <code class="language-plaintext highlighter-rouge">(1 + subject.age)</code>) is a basic expression again and thus may contain selection steps, filter, or subtemplate statements.</p>
<h5 id="value-expressions">
  
  
    <a href="#value-expressions" class="anchor-heading" aria-labelledby="value-expressions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Value Expressions
  
  
</h5>
    

<p>A basic value expression is the simplest type. The value is denoted in the corresponding JSON format.</p>

<p><code class="language-plaintext highlighter-rouge">true</code>, <code class="language-plaintext highlighter-rouge">false</code>, and <code class="language-plaintext highlighter-rouge">null</code> are value expressions as well as <code class="language-plaintext highlighter-rouge">"a string"</code>, <code class="language-plaintext highlighter-rouge">'a string'</code>, or any number (like <code class="language-plaintext highlighter-rouge">6</code> or <code class="language-plaintext highlighter-rouge">100.51</code>).</p>

<p>For denoting objects, the keys need to be strings, and the values can be any expression, e.g.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="err">(</span><span class="mi">3</span><span class="err">+</span><span class="mi">5</span><span class="err">)</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="err">functions.generate_name()</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></div></code></pre></div></div>

<p>For arrays, the items can be any expression, e.g.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="p">[</span><span class="w">
    </span><span class="err">(</span><span class="mi">3</span><span class="err">+</span><span class="mi">5</span><span class="err">)</span><span class="p">,</span><span class="w">
    </span><span class="err">subject.name</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></pre></td></tr></tbody></table></div></code></pre></div></div>
<h5 id="identifier-expressions">
  
  
    <a href="#identifier-expressions" class="anchor-heading" aria-labelledby="identifier-expressions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Identifier Expressions
  
  
</h5>
    

<p>A basic identifier expression consists of the name of a variable or the name of an authorization subscription attribute (i.e., <code class="language-plaintext highlighter-rouge">subject</code>, <code class="language-plaintext highlighter-rouge">resource</code>, <code class="language-plaintext highlighter-rouge">action</code>, or <code class="language-plaintext highlighter-rouge">environment</code>).</p>

<p>It evaluates to the variable or the attribute’s value.</p>
<h5 id="function-expressions">
  
  
    <a href="#function-expressions" class="anchor-heading" aria-labelledby="function-expressions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Function Expressions
  
  
</h5>
    

<p>A basic function expression consists of a function name and any number of arguments between parentheses which are separated by commas. The arguments must be expressions, e.g.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">library</span><span class="o">.</span><span class="na">a_function</span><span class="o">(</span><span class="n">subject</span><span class="o">.</span><span class="na">name</span><span class="o">,</span> <span class="o">(</span><span class="n">environment</span><span class="o">.</span><span class="na">day_of_week</span> <span class="o">+</span> <span class="mi">1</span><span class="o">))</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p>Each function is available under its fully qualified name. The fully qualified name starts with the library name, consisting of one or more identifiers separated by periods <code class="language-plaintext highlighter-rouge">.</code> (e.g., <code class="language-plaintext highlighter-rouge">sapl.functions.simple</code>). The library name is followed by a period <code class="language-plaintext highlighter-rouge">.</code> and an identifier for the function name (e.g., <code class="language-plaintext highlighter-rouge">sapl.functions.simple.append</code>). Which function libraries are available depends on the configuration of the PDP.</p>

<p><a href="#imports">Imports</a> at the beginning of a SAPL document can be used to make functions available under shorter names. If a function is imported via a basic import or a wildcard import, it is available under its function name (e.g., <code class="language-plaintext highlighter-rouge">append</code>). A library alias import provides an alternative library name (e.g., with the import statement <code class="language-plaintext highlighter-rouge">import sap.functions.simple as simple</code>, the append function would be available under <code class="language-plaintext highlighter-rouge">simple.append</code>.</p>

<p>If there are no arguments passed to the function, empty parentheses have to be denoted (e.g., <code class="language-plaintext highlighter-rouge">random_number()</code>).</p>

<p>When evaluating a function expression, the expressions representing the function call arguments are evaluated first. Afterward, the results are passed to the function as arguments. The expression evaluates to the function’s return value.</p>
<h5 id="relative-expressions">
  
  
    <a href="#relative-expressions" class="anchor-heading" aria-labelledby="relative-expressions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Relative Expressions
  
  
</h5>
    

<p>The basic relative expression is the <code class="language-plaintext highlighter-rouge">@</code> symbol.</p>

<p>It can be used in various contexts. Those contexts are characterized by an implicit loop with <code class="language-plaintext highlighter-rouge">@</code> dynamically evaluating to the current element. Assuming the variable <code class="language-plaintext highlighter-rouge">array</code> contains an array with multiple numbers, the expression <code class="language-plaintext highlighter-rouge">array[?(@ &gt; 10)]</code> can be used to return any element greater than 10. In this context, <code class="language-plaintext highlighter-rouge">@</code> evaluates to the array item for which the condition is currently checked.</p>

<p>The contexts in which <code class="language-plaintext highlighter-rouge">@</code> can be used are:</p>

<ul>
  <li>Expressions within a condition step (<code class="language-plaintext highlighter-rouge">@</code> evaluates to the array item or attribute value for which the condition expression is currently evaluated)</li>
  <li>Subtemplate (<code class="language-plaintext highlighter-rouge">@</code> evaluates to the array item which is currently going to be replaced by the subtemplate)</li>
  <li>Arguments of a filter function if <code class="language-plaintext highlighter-rouge">each</code> is used (<code class="language-plaintext highlighter-rouge">@</code> evaluates to the array item to which the filter function is going to be applied)</li>
</ul>
<h4 id="operators">
  
  
    <a href="#operators" class="anchor-heading" aria-labelledby="operators"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Operators
  
  
</h4>
    

<p>SAPL provides a collection of arithmetic, comparison, logical, string and filtering operators, which can be used to build expressions from other expressions.</p>
<h5 id="arithmetic-operators">
  
  
    <a href="#arithmetic-operators" class="anchor-heading" aria-labelledby="arithmetic-operators"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Arithmetic Operators
  
  
</h5>
    

<p>Assuming <code class="language-plaintext highlighter-rouge">exp1</code> and <code class="language-plaintext highlighter-rouge">exp2</code> are expressions evaluating to numbers, the following operators can be applied. All of them evaluate to number.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">-exp1</code> (negation)</li>
  <li><code class="language-plaintext highlighter-rouge">exp1 * exp2</code> (multiplication)</li>
  <li><code class="language-plaintext highlighter-rouge">exp1 / exp2</code> (division)</li>
  <li><code class="language-plaintext highlighter-rouge">exp1 + exp2</code> (addition)</li>
  <li><code class="language-plaintext highlighter-rouge">exp1 - exp2</code> (subtraction)</li>
</ul>

<p>An expression can contain multiple arithmetic operators. The order in which they are evaluated can be specified using <strong>parentheses</strong>, e.g., <code class="language-plaintext highlighter-rouge">(1 + 2) * 3</code>.</p>

<p>In case multiple operators are used without parentheses (e.g., <code class="language-plaintext highlighter-rouge">4 + 3 * 2</code>), the <strong>operator precedence</strong> determines how the expression is evaluated. Operators with higher precedence are evaluated first. The following precedence is assigned to arithmetic operators:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">-</code> (negation): precedence <strong>4</strong></li>
  <li><code class="language-plaintext highlighter-rouge">*</code> (multiplication), <code class="language-plaintext highlighter-rouge">/</code> (division): precedence <strong>2</strong></li>
  <li><code class="language-plaintext highlighter-rouge">+</code> (addition), <code class="language-plaintext highlighter-rouge">-</code> (subtraction): precedence <strong>1</strong></li>
</ul>

<p>As <code class="language-plaintext highlighter-rouge">*</code> has a higher precedence than <code class="language-plaintext highlighter-rouge">+</code>, <code class="language-plaintext highlighter-rouge">4 + 3 * 2</code> would be evaluated as <code class="language-plaintext highlighter-rouge">4 + (3 * 2)</code>.</p>

<p>Except for the negation, multiple operators with the same precedence (e.g., <code class="language-plaintext highlighter-rouge">5 - 2 + 1</code>) are <strong>left-associative</strong>, i.e., <code class="language-plaintext highlighter-rouge">5 - 2 + 1</code> is evaluated like <code class="language-plaintext highlighter-rouge">(5 - 2) + 1</code>. The negation is non-associative, i.e., <code class="language-plaintext highlighter-rouge">--1</code> needs to be replaced by <code class="language-plaintext highlighter-rouge">-(-1)</code>.</p>
<h5 id="comparison-operators">
  
  
    <a href="#comparison-operators" class="anchor-heading" aria-labelledby="comparison-operators"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Comparison Operators
  
  
</h5>
    

<ol>
  <li>
    <p>Number comparison</p>

    <p>Assuming <code class="language-plaintext highlighter-rouge">exp1</code> and <code class="language-plaintext highlighter-rouge">exp2</code> are expressions evaluating to numbers, the following operators can be applied. All of them evaluate to <code class="language-plaintext highlighter-rouge">true</code> or <code class="language-plaintext highlighter-rouge">false</code>.</p>
    <ol>
      <li><code class="language-plaintext highlighter-rouge">exp1 &lt; exp2</code> (<code class="language-plaintext highlighter-rouge">true</code> if <code class="language-plaintext highlighter-rouge">exp2</code> is greater than <code class="language-plaintext highlighter-rouge">exp1</code>)</li>
      <li><code class="language-plaintext highlighter-rouge">exp1 &gt; exp2</code> (<code class="language-plaintext highlighter-rouge">true</code> if <code class="language-plaintext highlighter-rouge">exp1</code> is greater than <code class="language-plaintext highlighter-rouge">exp2</code>)</li>
      <li><code class="language-plaintext highlighter-rouge">exp1 &lt;= exp2</code> (<code class="language-plaintext highlighter-rouge">true</code> if <code class="language-plaintext highlighter-rouge">exp2</code> is equal to or greater than <code class="language-plaintext highlighter-rouge">exp1</code>)</li>
      <li><code class="language-plaintext highlighter-rouge">exp1 &gt;= exp2</code> (<code class="language-plaintext highlighter-rouge">true</code> if <code class="language-plaintext highlighter-rouge">exp1</code> is equal to or greater than <code class="language-plaintext highlighter-rouge">exp2</code>)</li>
    </ol>
  </li>
  <li>
    <p>Equals</p>

    <p>Assuming <code class="language-plaintext highlighter-rouge">exp1</code> and <code class="language-plaintext highlighter-rouge">exp2</code> are expressions, the equals-operator can be used to compare the results:</p>

    <p><code class="language-plaintext highlighter-rouge">exp1 == exp2</code></p>

    <p>The expression evaluates to <code class="language-plaintext highlighter-rouge">true</code> if the result of evaluating <code class="language-plaintext highlighter-rouge">exp1</code> is equal to the result of evaluating <code class="language-plaintext highlighter-rouge">exp2</code>.</p>
  </li>
  <li>
    <p>Regular Expression</p>

    <p>Assuming <code class="language-plaintext highlighter-rouge">exp1</code> and <code class="language-plaintext highlighter-rouge">exp2</code> are expressions evaluating to strings, the regular expression match operator can be used:</p>

    <p><code class="language-plaintext highlighter-rouge">exp1 =~ exp2</code></p>

    <p>The expression evaluates to <code class="language-plaintext highlighter-rouge">true</code> if the result of evaluating <code class="language-plaintext highlighter-rouge">exp1</code> matches the pattern contained in the result of evaluating <code class="language-plaintext highlighter-rouge">exp2</code>. The pattern needs to be specified according to the <a href="https://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html">java.util.regex package</a>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">in</code> (element of)</p>

    <p>Assuming <code class="language-plaintext highlighter-rouge">exp1</code> is an expression and <code class="language-plaintext highlighter-rouge">exp2</code> is an expression evaluating to an array, the <code class="language-plaintext highlighter-rouge">in</code> operator can be used:</p>

    <p><code class="language-plaintext highlighter-rouge">exp1 in exp2</code></p>

    <p>The expression evaluates to <code class="language-plaintext highlighter-rouge">true</code> if the array <code class="language-plaintext highlighter-rouge">exp2</code> evaluates to contains the result of evaluating <code class="language-plaintext highlighter-rouge">exp1</code>. Otherwise, the expression evaluates to <code class="language-plaintext highlighter-rouge">false</code>.</p>
  </li>
  <li>
    <p>Precedence and Associativity</p>

    <p>All comparison operators have precedence <strong>3</strong>. This is important for combining them with logical operators (see below).</p>

    <p><code class="language-plaintext highlighter-rouge">&lt;</code>, <code class="language-plaintext highlighter-rouge">&gt;</code>, <code class="language-plaintext highlighter-rouge">&lt;=</code>, <code class="language-plaintext highlighter-rouge">&gt;=</code>, <code class="language-plaintext highlighter-rouge">==</code>,<code class="language-plaintext highlighter-rouge">=~</code> and <code class="language-plaintext highlighter-rouge">in</code> are <strong>non-associative</strong>, i.e., an expression may not contain multiple comparison operators (like <code class="language-plaintext highlighter-rouge">3 &lt; var &lt; 5</code>). However, they can be combined with logical operators which have a different precedence (thus, the faulty example could be replaced by <code class="language-plaintext highlighter-rouge">3 &lt; var &amp;&amp; var &lt; 5</code>).</p>
  </li>
</ol>
<h5 id="logical-operators">
  
  
    <a href="#logical-operators" class="anchor-heading" aria-labelledby="logical-operators"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Logical Operators
  
  
</h5>
    

<p>Assuming <code class="language-plaintext highlighter-rouge">exp1</code> and <code class="language-plaintext highlighter-rouge">exp2</code> are expressions evaluating to <code class="language-plaintext highlighter-rouge">true</code> or <code class="language-plaintext highlighter-rouge">false</code>, the following operators can be applied. The new expression evaluates to <code class="language-plaintext highlighter-rouge">true</code> or <code class="language-plaintext highlighter-rouge">false</code>:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">!exp1</code> (negation), precedence <strong>4</strong></li>
  <li><code class="language-plaintext highlighter-rouge">exp1 &amp;&amp; exp2</code> or <code class="language-plaintext highlighter-rouge">exp1 &amp; exp2</code> (logical AND), precedence <strong>2</strong></li>
  <li><code class="language-plaintext highlighter-rouge">exp1 || exp2</code> or <code class="language-plaintext highlighter-rouge">exp1 | exp2</code> (logical OR), precedence <strong>1</strong></li>
</ul>

<p>The difference between <code class="language-plaintext highlighter-rouge">&amp;&amp;</code> and <code class="language-plaintext highlighter-rouge">&amp;</code> (or <code class="language-plaintext highlighter-rouge">||</code> and <code class="language-plaintext highlighter-rouge">|</code>) is that for <code class="language-plaintext highlighter-rouge">&amp;&amp;</code> lazy evaluation is used while <code class="language-plaintext highlighter-rouge">&amp;</code> causes eager evaluation. Using <code class="language-plaintext highlighter-rouge">&amp;&amp;</code>, if the left side evaluates to <code class="language-plaintext highlighter-rouge">false</code> and the right side would cause an error, the result of the operator is <code class="language-plaintext highlighter-rouge">false</code>. The right side is not evaluated. The same applies for <code class="language-plaintext highlighter-rouge">||</code> if the left side evaluates to <code class="language-plaintext highlighter-rouge">true</code>. In this case, the operator evaluates to <code class="language-plaintext highlighter-rouge">true</code>, even if the right side would cause an error - the right side is ignored if the result can already be determined. This is different for <code class="language-plaintext highlighter-rouge">&amp;</code> and <code class="language-plaintext highlighter-rouge">|</code> which always evaluate both sides first (eager evaluation). Whenever there is an error, the expression does not return a result. In a target expression, only the eager evaluation expressions <code class="language-plaintext highlighter-rouge">&amp;</code> and <code class="language-plaintext highlighter-rouge">|</code> can be used.</p>

<p>The operators are already listed in descending order of their <strong>precedence</strong>, i.e., <code class="language-plaintext highlighter-rouge">!</code> has the highest precedence followed by <code class="language-plaintext highlighter-rouge">&amp;&amp;</code>/<code class="language-plaintext highlighter-rouge">&amp;</code> and <code class="language-plaintext highlighter-rouge">||</code>/<code class="language-plaintext highlighter-rouge">|</code>. The order of evaluation can be changed by using parentheses.</p>

<p><code class="language-plaintext highlighter-rouge">&amp;&amp;</code> and <code class="language-plaintext highlighter-rouge">||</code> are left-associative, i.e., in case an expression contains multiple operators the leftmost operator is evaluated first. <code class="language-plaintext highlighter-rouge">!</code> is non-associative, i.e., <code class="language-plaintext highlighter-rouge">!!true</code> must be replaced by <code class="language-plaintext highlighter-rouge">!(!true))</code>.</p>
<h5 id="string-concatenation">
  
  
    <a href="#string-concatenation" class="anchor-heading" aria-labelledby="string-concatenation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> String Concatenation
  
  
</h5>
    

<p>The operator <code class="language-plaintext highlighter-rouge">+</code> concatenates two strings, e.g., <code class="language-plaintext highlighter-rouge">"Hello" + " World!"</code> evaluates to <code class="language-plaintext highlighter-rouge">"Hello World!"</code>.</p>

<p>String concatenation is applied if the left operand is an expression evaluating to a string. If the right expression evaluates to a string as well, the two strings are concatenated. Otherwise, an error is thrown.</p>
<h4 id="selection-steps">
  
  
    <a href="#selection-steps" class="anchor-heading" aria-labelledby="selection-steps"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Selection Steps
  
  
</h4>
    

<p>SAPL provides an easy way of accessing attributes of an object (or items of an array). The <strong>basic access</strong> mechanism has a similar syntax to programming languages like JavaScript or Java (e.g., <code class="language-plaintext highlighter-rouge">object.attribute</code>, <code class="language-plaintext highlighter-rouge">user.address.street</code> or <code class="language-plaintext highlighter-rouge">array[10]</code>). Beyond that, SAPL offers <strong>extended possibilities</strong> for expressing more sophisticated queries against JSON structures (e.g., <code class="language-plaintext highlighter-rouge">persons[?(@.age &gt;= 50)]</code>).</p>
<h5 id="overview">
  
  
    <a href="#overview" class="anchor-heading" aria-labelledby="overview"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Overview
  
  
</h5>
    

<p>The following table provides an overview of the different types of selection steps.</p>

<p>Given that the following object is stored in the variable <code class="language-plaintext highlighter-rouge">object</code>:</p>

<p>Structure of <code class="language-plaintext highlighter-rouge">object</code></p>

<pre><code class="language-JSON">{
    "key" : "value1",
    "array1" : [
        { "key" : "value2" },
        { "key" : "value3" }
    ],
    "array2" : [
        1, 2, 3, 4, 5
    ]
}
</code></pre>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th>Expression</th>
      <th>Returned Value</th>
      <th>Explanation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">object.key</code>  <br /><code class="language-plaintext highlighter-rouge">object['key']</code>  <br /><code class="language-plaintext highlighter-rouge">object["key"]</code></td>
      <td><code class="language-plaintext highlighter-rouge">"value1"</code></td>
      <td><strong>Key step</strong> in dot notation and bracket notation</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">object.array1[0]</code></td>
      <td><code class="language-plaintext highlighter-rouge">{ "key" : "value2" }</code></td>
      <td><strong>Index step</strong></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">object.array2[-1]</code></td>
      <td><code class="language-plaintext highlighter-rouge">5</code></td>
      <td><strong>Index step</strong> with negative value n returns the n-th last element</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">object.*</code>  <br /><code class="language-plaintext highlighter-rouge">object[*]</code></td>
      <td>[“value1”,<br />      [<br />        { “key” : “value2” },<br />        { “key” : “value3” }<br />      ],<br />      [ 1, 2, 3, 4, 5 ]<br />    ]</td>
      <td><strong>Wildcard step</strong> applied to an object, it returns an array with the value of each attribute - applied to an array, it returns the array itself</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">object.array2[0:-2:2]</code></td>
      <td><code class="language-plaintext highlighter-rouge">[ 1, 3 ]</code></td>
      <td><strong>Array slicing step</strong> starting from first to second last element with a step size of two</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">object..key</code>  <br /><code class="language-plaintext highlighter-rouge">object..['key']</code>  <br /><code class="language-plaintext highlighter-rouge">object..["key"]</code></td>
      <td><code class="language-plaintext highlighter-rouge">[ "value1", "value2", "value3" ]</code></td>
      <td><strong>Recursive descent step</strong> looking for an attribute</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">object..[0]</code></td>
      <td><code class="language-plaintext highlighter-rouge">[ { "key" : "value2" }, 1 ]</code></td>
      <td><strong>Recursive descent step</strong> looking for an array index</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">object.array2[(3+1)]</code></td>
      <td><code class="language-plaintext highlighter-rouge">5</code></td>
      <td><strong>Expression step</strong> that evaluates to number (index) - can also evaluate to an attribute name</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">object.array2[?(@&gt;2)]</code></td>
      <td><code class="language-plaintext highlighter-rouge">[ 3, 4, 5 ]</code></td>
      <td><strong>Condition step</strong> that evaluates to true/false, <code class="language-plaintext highlighter-rouge">@</code> is a reference to the currently examined item - can also be applied to an object</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">object.array2[2,3]</code></td>
      <td><code class="language-plaintext highlighter-rouge">[ 3 , 4 ]</code></td>
      <td><strong>Union step</strong> for more than one array index</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">object["key","array2"]</code></td>
      <td><code class="language-plaintext highlighter-rouge">[ "value1", [ 1, 2, 3, 4, 5 ] ]</code></td>
      <td><strong>Union step</strong> for more than one attribute</td>
    </tr>
  </tbody>
</table></div>

<p><em>Table 1. Selection Steps Overview</em></p>
<h5 id="basic-access">
  
  
    <a href="#basic-access" class="anchor-heading" aria-labelledby="basic-access"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Basic Access
  
  
</h5>
    

<p>The basic access syntax is quite similar to accessing an object’s attributes in JavaScript or Java:</p>

<ul>
  <li><strong>Attributes of an object</strong> can be accessed by their key (<strong>key step</strong>) using the <em>dot notation</em> (<code class="language-plaintext highlighter-rouge">resource.key</code>) or the <em>bracket notation</em> (<code class="language-plaintext highlighter-rouge">resource["key"]</code>,<code class="language-plaintext highlighter-rouge">resource['key']</code>). Both expressions return the value of the specified attribute. For using the dot notation, the specified key must be an <a href="#identifiers">identifier</a>. Otherwise, the bracket notation with a string between square brackets is necessary, e.g., if the key contains whitespace characters (<code class="language-plaintext highlighter-rouge">resource['another key']</code>).</li>
  <li><strong>Indices of an array</strong> may be accessed by putting the index between square brackets (<strong>index step</strong>, <code class="language-plaintext highlighter-rouge">array[3]</code>). The index can be a negative number <code class="language-plaintext highlighter-rouge">-n</code>, which evaluates to the <code class="language-plaintext highlighter-rouge">n</code>-th element from the end of the array, starting with -1 as the last element’s index. <code class="language-plaintext highlighter-rouge">array[-2]</code> would return the second last element of the array <code class="language-plaintext highlighter-rouge">array</code>.</li>
</ul>

<p>Multiple selection steps can be <strong>chained</strong>. The steps are evaluated from left to right. Each step is applied to the result returned from the previous step.</p>

<p>| <strong>Example</strong> <br /><br />The expression object.array[2] first selects the attribute with key array from the object object (first step). Then it returns the third element (index 2) of that array (second step). |
|————————————————————————————————————————————————————————————————-|</p>
<h5 id="extended-possibilities">
  
  
    <a href="#extended-possibilities" class="anchor-heading" aria-labelledby="extended-possibilities"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Extended Possibilities
  
  
</h5>
    

<p>SAPL supports querying for specific parts of a JSON structure. Except for an <strong>expression step</strong>, all of these steps return an array since the number of elements found can vary. Even if only a single result is retrieved, the expression returns an array containing one item.</p>
<h6 id="expression-step-expression">
  
  
    <a href="#expression-step-expression" class="anchor-heading" aria-labelledby="expression-step-expression"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Expression Step <code class="language-plaintext highlighter-rouge">[(Expression)]</code>
  
  
</h6>
    

<p>An expression step returns the value of an attribute with a key or an array item with an index specified by an expression. <code class="language-plaintext highlighter-rouge">Expression</code> must evaluate to a string or a number. If <code class="language-plaintext highlighter-rouge">Expression</code> evaluates to a string, the selection can only be applied to an object. If <code class="language-plaintext highlighter-rouge">Expression</code> evaluates to a number, the selection can only be applied to an array.</p>

<blockquote class="note">
  <p>The expression step can be used to refer to custom variables (<code class="language-plaintext highlighter-rouge">object.array[(anIndex+2)]</code>) or apply custom functions (<code class="language-plaintext highlighter-rouge">object.array[(max_value(object.array))]</code>.</p>
</blockquote>
<h6 id="wildcard-step--or-">
  
  
    <a href="#wildcard-step--or-" class="anchor-heading" aria-labelledby="wildcard-step--or-"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Wildcard Step <code class="language-plaintext highlighter-rouge">.*</code> or <code class="language-plaintext highlighter-rouge">[*]</code>
  
  
</h6>
    

<p>A wildcard step can be applied to an object or an array. When applied to an object, it returns an array containing all attribute values. As attributes of an object have no order, the sorting of the result is not defined. When applied to an array, the step just leaves the array untouched.</p>

<blockquote class="note">
  <p>Applied to an object <code class="language-plaintext highlighter-rouge">{"key1":"value1", "key2":"value2"}</code>, the selection step <code class="language-plaintext highlighter-rouge">.*</code> or <code class="language-plaintext highlighter-rouge">[*]</code> returns the following array: <code class="language-plaintext highlighter-rouge">["value1", "value2"]</code> (possibly with a different sorting of the items). Applied to an array <code class="language-plaintext highlighter-rouge">[1, 2, 3]</code>, the selection step <code class="language-plaintext highlighter-rouge">.</code> <strong>or</strong> <code class="language-plaintext highlighter-rouge">[]</code> returns the original array <code class="language-plaintext highlighter-rouge">[1, 2, 3]</code>.</p>
</blockquote>
<h6 id="recursive-descent-step-key-key-1--or-">
  
  
    <a href="#recursive-descent-step-key-key-1--or-" class="anchor-heading" aria-labelledby="recursive-descent-step-key-key-1--or-"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recursive Descent Step <code class="language-plaintext highlighter-rouge">..key</code>, <code class="language-plaintext highlighter-rouge">..["key"]</code>, <code class="language-plaintext highlighter-rouge">..[1]</code>, <code class="language-plaintext highlighter-rouge">..*</code> or <code class="language-plaintext highlighter-rouge">..[*]</code>
  
  
</h6>
    

<p>Looks for the specified key or array index in the current object or array and, recursively, in its children (i.e., the values of its attributes or its items). The recursive descent step can be applied to both an object and an array. It returns an array containing all attribute values or array items found. If the specified key is an asterisk (<code class="language-plaintext highlighter-rouge">..</code> <strong>or</strong> <code class="language-plaintext highlighter-rouge">[]</code>, wildcard), all attribute values and array items in the whole structure are returned.</p>

<p>As attributes of an object are not sorted, the order of items in the result array may vary.</p>

<blockquote class="note">
  <p>Applied to an <code class="language-plaintext highlighter-rouge">object</code></p>

  <p>{
“key” : “value1”,
“anotherkey” : {
“key” : “value2”
}
}</p>

  <p>The selection step <code class="language-plaintext highlighter-rouge">object..key</code> returns the following array: <code class="language-plaintext highlighter-rouge">["value1", "value2"]</code> (any attribute value with key <code class="language-plaintext highlighter-rouge">key</code>, the items may be in a different order).</p>

  <p>The wildcard selection step <code class="language-plaintext highlighter-rouge">object..</code> <strong>or</strong> <code class="language-plaintext highlighter-rouge">object..[]</code> returns <code class="language-plaintext highlighter-rouge">["value1", {"key":"value2"}, "value2"]</code> (recursively each attribute value and array item in the whole structure <code class="language-plaintext highlighter-rouge">object</code>, the sorting may be different).</p>
</blockquote>
<h6 id="condition-condition">
  
  
    <a href="#condition-condition" class="anchor-heading" aria-labelledby="condition-condition"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Condition <code class="language-plaintext highlighter-rouge">[?(Condition)]</code>
  
  
</h6>
    

<p>Condition steps return an array containing all attribute values or array items for which <code class="language-plaintext highlighter-rouge">Condition</code> evaluates to <code class="language-plaintext highlighter-rouge">true</code>. It can be applied to both an object (then it checks each attribute value) and an array (then it checks each item). <code class="language-plaintext highlighter-rouge">Condition</code> must be an expression in which <a href="#basic-relative">relative expressions</a> starting with <code class="language-plaintext highlighter-rouge">@</code> can be used. <code class="language-plaintext highlighter-rouge">@</code> evaluates to the current attribute value or array item for which the condition is evaluated and can be followed by further selection steps.</p>

<p>As attributes have no order, the sorting of the result array of a condition step applied to an object is not specified.</p>

<blockquote class="note">
  <p>Applied to the array <code class="language-plaintext highlighter-rouge">[1, 2, 3, 4, 5]</code>, the selection step <code class="language-plaintext highlighter-rouge">[?(@ &gt; 2)]</code> returns the array <code class="language-plaintext highlighter-rouge">[3, 4, 5]</code> (containing all values that are greater than 2).</p>
</blockquote>
<h6 id="array-slicing-startstopstep">
  
  
    <a href="#array-slicing-startstopstep" class="anchor-heading" aria-labelledby="array-slicing-startstopstep"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Array Slicing <code class="language-plaintext highlighter-rouge">[Start:Stop:Step]</code>
  
  
</h6>
    

<p>The slice contains the items with indices between <code class="language-plaintext highlighter-rouge">Start</code> and <code class="language-plaintext highlighter-rouge">Stop</code>, with <code class="language-plaintext highlighter-rouge">Start</code> being inclusive and <code class="language-plaintext highlighter-rouge">Stop</code> being exclusive. <code class="language-plaintext highlighter-rouge">Step</code> describes the distance between the elements to be included in the slice, i.e., with a <code class="language-plaintext highlighter-rouge">Step</code> of 2, only each second element would be included (with <code class="language-plaintext highlighter-rouge">Start</code> as the first element’s index). All parts except the first colon are optional. <code class="language-plaintext highlighter-rouge">Step</code> defaults to 1.</p>

<p>In case <code class="language-plaintext highlighter-rouge">Step</code> is positive, <code class="language-plaintext highlighter-rouge">Start</code> defaults to 0 and <code class="language-plaintext highlighter-rouge">Stop</code> defaults to the length of the array. If <code class="language-plaintext highlighter-rouge">Step</code> is negative, <code class="language-plaintext highlighter-rouge">Start</code> defaults to the length of the array minus 1 (i.e., the last element’s index) and <code class="language-plaintext highlighter-rouge">Stop</code> defaults to -1. A <code class="language-plaintext highlighter-rouge">Step</code> of 0 leads to an error.</p>

<blockquote class="note">
  <p>Applied to the Array <code class="language-plaintext highlighter-rouge">[1, 2, 3, 4, 5]</code>, the selection step <code class="language-plaintext highlighter-rouge">[-2:]</code> returns the Array <code class="language-plaintext highlighter-rouge">[4, 5]</code> (the last two elements).</p>
</blockquote>

<blockquote class="note">
  <p>If Start and Stop are to be left empty, the two colons must be separated by a whitespace to avoid confusion with the sub-template operator. So write <code class="language-plaintext highlighter-rouge">[: :-2]</code> instead of <code class="language-plaintext highlighter-rouge">[::-2]</code>.</p>
</blockquote>
<h6 id="index-union-index1-index2-">
  
  
    <a href="#index-union-index1-index2-" class="anchor-heading" aria-labelledby="index-union-index1-index2-"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Index Union <code class="language-plaintext highlighter-rouge">[index1, index2, …​]</code>
  
  
</h6>
    

<p>By using the bracket notation, a set of multiple array indices (numbers) can be denoted separated by commas. This returns an array containing the items of the original array if the item’s index is contained in the specified indices. Since a <strong>set</strong> of indices is specified, the indices’ order is ignored, and duplicate elements are removed. The result array contains the specified elements in their original order. Indices that do not exist in the original array are ignored.</p>

<blockquote class="note">
  <p>Both <code class="language-plaintext highlighter-rouge">[3, 2, 2]</code> and <code class="language-plaintext highlighter-rouge">[2, 3]</code> return the same result.</p>
</blockquote>
<h6 id="attribute-union-attribute1-attribute2-">
  
  
    <a href="#attribute-union-attribute1-attribute2-" class="anchor-heading" aria-labelledby="attribute-union-attribute1-attribute2-"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Attribute Union <code class="language-plaintext highlighter-rouge">["attribute1", "attribute2", …​]</code>
  
  
</h6>
    

<p>By using the bracket notation, a set of multiple attribute keys (strings) can be denoted separated by commas. This returns an array containing the values of the denoted attributes. Since a <strong>set</strong> of attribute keys is specified, the keys’ order is ignored, and duplicate elements are removed. As attributes have no order, the sorting of the resulting array is not specified. Attributes that do not exist are ignored.</p>
<h6 id="attribute-selection-on-array">
  
  
    <a href="#attribute-selection-on-array" class="anchor-heading" aria-labelledby="attribute-selection-on-array"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Attribute Selection on Array
  
  
</h6>
    

<p>Although arrays do not have attributes (they have items), a key step can be applied to an array (e.g., <code class="language-plaintext highlighter-rouge">array.value</code>). This will loop through each item of the array and look for the specified attribute in this item. An array containing all values of the attributes found is returned. In other words, the selection step is not applied to the result of the previous step (the array) but to each item of the result, and the (sub-)results are concatenated. In case an array item is no object or does not contain the specified attribute, it is skipped.</p>

<blockquote class="note">
  <p>Applied to an object</p>

  <p>{
“array”:[
{“key”:”value1”},
{“key”:”value2”}
]
}</p>

  <p><code class="language-plaintext highlighter-rouge">array.key</code> returns the following array: <code class="language-plaintext highlighter-rouge">["value1", "value2"]</code> (the value of the <code class="language-plaintext highlighter-rouge">key</code> attribute of each item of <code class="language-plaintext highlighter-rouge">array</code>).</p>
</blockquote>
<h6 id="attribute-finder-findername">
  
  
    <a href="#attribute-finder-findername" class="anchor-heading" aria-labelledby="attribute-finder-findername"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Attribute Finder <code class="language-plaintext highlighter-rouge">.&lt;finder.name&gt;</code>
  
  
</h6>
    

<p>In SAPL, it is possible to receive attributes that are not contained in the authorization subscription. Those attributes can be provided by external PIPs and obtained through attribute finders.</p>

<p>The standard attributes in SAPL are intended to gather more information with regards to a given JSON value, i.e., the subject, action, resource, environment objects in the subscription, or any other JSON value.</p>

<p>A standard attribute finder is called via the selection step <code class="language-plaintext highlighter-rouge">.&lt;finder.name&gt;</code>. Where <code class="language-plaintext highlighter-rouge">finder.name</code> either is a fully qualified attribute finder name or can be a shorter name if imports are used (the finder name or the library alias followed by a period <code class="language-plaintext highlighter-rouge">.</code> and the finder name). Any number of selection steps can be appended after such a step.</p>

<p>An attribute accessed this way is treated as a subscription. I.e., the PDP will subscribe to the data source, and whenever a new value is returned, the policy is reevaluated, and a new decision is calculated.</p>

<p>The attribute finder receives the result of the previous selection as an argument and returns a JSON value. Optionally, an attribute finder may be supplied with a list of parameters: <code class="language-plaintext highlighter-rouge">.&lt;finder.name(p1,p2,…​)&gt;</code>.</p>

<p>Attribute finders may be nested: <code class="language-plaintext highlighter-rouge">subject.&lt;finder.name2&gt;.&lt;finder.name(p1,action.&lt;finder.name3&gt;,…​)&gt;</code>. Here, whenever the attributes with <code class="language-plaintext highlighter-rouge">name2</code> and <code class="language-plaintext highlighter-rouge">name3</code> all have an initial result, and whenever one of the results change, the attribute with name <code class="language-plaintext highlighter-rouge">name</code> is re-subscribed with the new input parameters.</p>

<p>An environment attribute finder is an attribute finder intended for accessing information possibly independent of subscription data, e.g., current time or an organization-wide emergency level. These environment attributes are not to be confused with the data which is contained in the environment object in the subscription. The data contained there is environment data provided by the PEP from its application context at subscription time and may not be accessible from the PDP otherwise. Environment attributes do not require a left-hand input and can be accessed without a leading value, variable, or sequence of selection steps: <code class="language-plaintext highlighter-rouge">&lt;organization.emergencyLevel&gt;</code> may refer to a stream indicating an emergency level in an organization. Analogous to standard attributes, these attributes may be parameterized and nested.</p>

<p>All attribute finders may be followed by arbitrary selection steps.</p>

<p>In some scenarios, it may not be the right thing to subscribe to attributes, but to just retrieve the data once on subscription time. For this, SAPL offers the head operator for both standard and environment attributes. Prepending the pipe symbol <code class="language-plaintext highlighter-rouge">|</code> in front of an attribute finder step will only return the first value returned by the attribute finder. E.g.: <code class="language-plaintext highlighter-rouge">subject.id.|&lt;geo.location&gt;</code>. However, such an attribute may still return a stream if used with nested attributes which do not employ the head operator.</p>

<blockquote class="note">
  <p>Assuming a doctor should only be allowed to access patient data from patients on her unit. The following expression retrieves the unit (attribute finder <code class="language-plaintext highlighter-rouge">pip.hospital_units.by_patientid</code>) by the requested patient id (<code class="language-plaintext highlighter-rouge">action.patientid</code>) and selects the id of the supervising doctor (<code class="language-plaintext highlighter-rouge">.doctorid</code>):</p>

  <p>action.patientid.<pip.hospital_units.by_patientid>.doctorid</pip.hospital_units.by_patientid></p>
</blockquote>

<p>Attribute finders are described in greater detail <a href="#attribute-finders">below</a>.</p>
<h4 id="filtering">
  
  
    <a href="#filtering" class="anchor-heading" aria-labelledby="filtering"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Filtering
  
  
</h4>
    

<p>SAPL provides syntax elements filtering values by applying <strong>filters</strong>, and that can potentially modify the value.</p>

<p>Filters can only be applied to basic expressions (remember that an expression in parentheses is a basic expression). Filtering is denoted by the <code class="language-plaintext highlighter-rouge">|-</code> operator after the expression. Which <strong>filter function</strong> is applied in what way can be defined by a <strong>simple filtering component</strong> or by an <strong>extended filtering component</strong>, which consists of several filter statements.</p>
<h5 id="filter-functions">
  
  
    <a href="#filter-functions" class="anchor-heading" aria-labelledby="filter-functions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Filter Functions
  
  
</h5>
    

<p>SAPL provides three <strong>built-in filter functions</strong>:</p>

<p>remove</p>

<p>Removes a whole attribute (key and value pair) of an object or an item of an array without leaving a replacement.</p>

<p>filter.replace(replacement)</p>

<p>Replaces an attribute or an element by the result of evaluating the expression <code class="language-plaintext highlighter-rouge">replacement</code>.</p>

<p>filter.blacken(disclose\_left=0,disclose\_right=0,replacement=”X”)</p>

<p>Replaces each char of an attribute or item (which must be a string) by <code class="language-plaintext highlighter-rouge">replacement</code>, leaving <code class="language-plaintext highlighter-rouge">show\_left</code> chars from the beginning and <code class="language-plaintext highlighter-rouge">show\_right</code> chars from the end unchanged. By default, no chars are visible, and each char is replaced by <code class="language-plaintext highlighter-rouge">X</code>.</p>

<blockquote class="note">
  <p><code class="language-plaintext highlighter-rouge">filter.blacken</code> could be used to reveal only the first digit of the credit card number and replace the other digits by <code class="language-plaintext highlighter-rouge">X</code>.</p>
</blockquote>

<blockquote class="note">
  <p><code class="language-plaintext highlighter-rouge">filter.replace</code> and <code class="language-plaintext highlighter-rouge">filter.blacken</code> are part of the library <code class="language-plaintext highlighter-rouge">filter</code>. Importing this library through <code class="language-plaintext highlighter-rouge">import filter</code> makes the functions available under their simple names.</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre>Example
We take the following object:

Object Structure

{
    "value" : "aValue",
    "id" : 5
}

If value is removed, the resulting object is { "id" : 5 }.

If instead filter.replace is applied to value with the Expression null, the resulting object is { "value" : null, "id" : 5 }.

If the function filter.blacken is applied to value without specifying any arguments, the result would be { "value" : "XXXXXX", "id" : 5 }.
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h5 id="simple-filtering">
  
  
    <a href="#simple-filtering" class="anchor-heading" aria-labelledby="simple-filtering"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Simple Filtering
  
  
</h5>
    

<p>A simple filter component applies a <strong>filter function</strong> to the preceding value. The syntax is:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>BasicExpression |- Function
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">BasicExpression</code> is evaluated to a value, the function is applied to this value, and the result is returned. If no other arguments are passed to the function, the empty parentheses <code class="language-plaintext highlighter-rouge">()</code> after the function name can be omitted.</p>

<p>In case <code class="language-plaintext highlighter-rouge">BasicExpression</code> evaluates to an array, the whole array is passed to the filter function. The <strong>keyword</strong> <code class="language-plaintext highlighter-rouge">each</code> before <code class="language-plaintext highlighter-rouge">Function</code> can be used to apply the function to each array item instead:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>Expression |- each Function
</pre></td></tr></tbody></table></div></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="rouge-code"><pre>Example

Let’s assume our resource contains an array of credit card numbers:

{
    "numbers": [
        "1234123412341234",
        "2345234523452345",
        "3456345634563456"
    ]
}

The function blacken(1) without any additional parameters takes a string and replaces everything by X except the first char. We can receive the blackened numbers through the basic expression resource.numbers |- each blacken(1):

[
    "1XXXXXXXXXXXXXXX",
    "2XXXXXXXXXXXXXXX",
    "3XXXXXXXXXXXXXXX"
]

Without the keyword each, the function blacken would be applied to the array itself, resulting in an error, as stated above, blacken can only be applied to a String.
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h5 id="extended-filtering">
  
  
    <a href="#extended-filtering" class="anchor-heading" aria-labelledby="extended-filtering"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Extended Filtering
  
  
</h5>
    

<p>Extended filtering can be used to state more precisely how a value should be altered.</p>

<p>E.g., the expression</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>resource |- { @.credit_card : blacken }
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p>would return the original resource except for the value of the attribute <code class="language-plaintext highlighter-rouge">credit_card</code> being blackened.</p>

<p>Extended filtering components consist of one or more <strong>filter statements</strong>. Each filter statement has a target expression and specifies a filter function that shall be applied to the attribute value (or to each of its items if the keyword <code class="language-plaintext highlighter-rouge">each</code> is used). The basic syntax is:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>Expression |- { 
				FilterStatement, 
				FilterStatement, 
				... 
}
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p>The syntax of a filter statement is:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>each TargetRelativeExpression : Function
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">each</code> is an optional keyword. If used, the <code class="language-plaintext highlighter-rouge">TargetRelativeExpression</code> must evaluate to an array. In this case, <code class="language-plaintext highlighter-rouge">Function</code> is applied to each item of that array.</p>

<p><code class="language-plaintext highlighter-rouge">TargetRelativeExpression</code> contains a basic relative expression starting with <code class="language-plaintext highlighter-rouge">@</code>. The character <code class="language-plaintext highlighter-rouge">@</code> references the result of the evaluation of <code class="language-plaintext highlighter-rouge">Expression</code>, so attributes of the value to filter can be accessed easily. Bear in mind that attribute finder steps are not allowed at this place. The value of the attribute selected by the target expression is replaced by the result of the filter function.</p>

<p>The filter statements are applied successively from top to bottom.</p>

<blockquote class="warning">
  <p>Some filter functions can be applied to both arrays and other types (e.g., <code class="language-plaintext highlighter-rouge">remove</code>). Yet, there are selection steps resulting in a “helper array” that cannot be modified. If, for instance, <code class="language-plaintext highlighter-rouge">.*</code> is applied to the object <code class="language-plaintext highlighter-rouge">{"key1" : "value1", "key2" : "value2"}</code>, the result would be <code class="language-plaintext highlighter-rouge">["value1", "value2"]</code>. It is not possible to apply a filter function directly to this array because changing the array itself would not have any effect. The array has been constructed merely to hold multiple values for further processing. In this case, the policy would <strong>have to</strong> use the keyword <code class="language-plaintext highlighter-rouge">each</code> and apply the function to each item. The attempt to alter a helper array will result in an error.</p>
</blockquote>
<h5 id="custom-filter-functions">
  
  
    <a href="#custom-filter-functions" class="anchor-heading" aria-labelledby="custom-filter-functions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Custom Filter Functions
  
  
</h5>
    

<p>Any function available in SAPL can be used in a filter statement. Hence it is easy to add custom filter functions.</p>

<p>When used in a filter statement, the value to filter is passed to the function as its first argument. Consequently, the arguments specified in the function call are passed as second, third, etc., arguments.</p>

<blockquote class="note">
  <p>Assuming a filter function <code class="language-plaintext highlighter-rouge">roundto</code> should round a value to the closest multiple of a given number, e.g., <code class="language-plaintext highlighter-rouge">207 |- roundto(100)</code> should return <code class="language-plaintext highlighter-rouge">200</code>. In its definition, the function needs two formal parameters. The first parameter is reserved for the original value and the second one for the number to round to.</p>
</blockquote>
<h4 id="subtemplate">
  
  
    <a href="#subtemplate" class="anchor-heading" aria-labelledby="subtemplate"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Subtemplate
  
  
</h4>
    

<p>It is possible to define a subtemplate for an array to replace each item of the array with this subtemplate. A subtemplate component is an optional part of a basic expression.</p>

<p>E.g., the basic expression:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>resource.patients :: { "name" : @.name }
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p>This expression would return the <code class="language-plaintext highlighter-rouge">patients</code> array from the resource but with each item containing only one attribute <code class="language-plaintext highlighter-rouge">name</code>.</p>

<p>The subtemplate is denoted after a double colon:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>Array :: Expression
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p>This <code class="language-plaintext highlighter-rouge">Expression</code> represents the replacement template. In this expression, basic relative expressions (starting with <code class="language-plaintext highlighter-rouge">@</code>) can be used to access the attributes of the current array item. <code class="language-plaintext highlighter-rouge">@</code> references the array item, which is currently being replaced. <code class="language-plaintext highlighter-rouge">Array</code> must evaluate to an array. For each item of <code class="language-plaintext highlighter-rouge">Array</code>, <code class="language-plaintext highlighter-rouge">Expression</code> is evaluated, and the item is replaced by the result.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="rouge-code"><pre>Example
Given the variable array contains the following array:

[
    { "id" : 1 },
    { "id" : 2 }
]

The basic expression

array :: {
    "aKey" : "aValue"
    "identifier" : @.id
}

would evaluate to:

[
    {"aKey" : "aValue", "identifier" : 1 },
    {"aKey" : "aValue", "identifier" : 2 }
]
</pre></td></tr></tbody></table></div></code></pre></div></div>


          

          
        </main>
        

  <hr>
  <footer>
    
      <p><a href="#top" id="back-to-top">Back to top</a></p>
    

    <p class="text-small text-grey-dk-100 mb-0">Copyright &copy; 2024 Dominic Heutelbeck. Distributed by an <a href="https://github.com/heutelbeck/sapl-policy-engine/blob/master/LICENSE.md">License.</a></p>

    
      <div class="d-flex mt-2">
        
        
      </div>
    
  </footer>


      </div>
    </div>
    
      

<div class="search-overlay"></div>

    
  </div>

  
    






  <script src="https://cdn.jsdelivr.net/npm/mermaid@9.1.6/dist/mermaid.min.js"></script>


<script>
  var config = {}
;
  mermaid.initialize(config);
  window.mermaid.init(undefined, document.querySelectorAll('.language-mermaid'));
</script>



  
</body>
</html>

