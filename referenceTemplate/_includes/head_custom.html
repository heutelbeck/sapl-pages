<!-- Favicon -->
<link rel="icon" href="/assets/sapl_reference_images/favicon.png" type="image/png">

<!-- Matomo Analytics -->
<script type="text/javascript">
    var _paq = window._paq || [];    
    _paq.push(["disableCookies"]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
        var u="//www.ftk.de/statistik/";
        _paq.push(['setTrackerUrl', u+'matomo.php']);
        _paq.push(['setSiteId', '2']);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
        g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
    })();
</script>
<!-- End Matomo Code -->

<!-- Mermaid Diagram Support -->
<script type="module">
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
  
  // Detect current theme (Just the Docs)
  function getCurrentTheme() {
    if (typeof jtd !== 'undefined' && jtd.getTheme) {
      return jtd.getTheme();
    }
    return document.documentElement.getAttribute('data-color-mode') === 'dark' ? 'dark' : 'light';
  }
  
  // Initialize Mermaid with theme
  function initMermaid() {
    const isDark = getCurrentTheme() === 'dark';
    
    mermaid.initialize({ 
      startOnLoad: true,
      theme: isDark ? 'dark' : 'base',
      securityLevel: 'loose',
      themeVariables: isDark ? {
        // Dark mode - match code block aesthetic
        darkMode: true,
        background: '#1e1e1e',
        
        // Primary elements (boxes/nodes)
        primaryColor: '#2d333b',           // Dark gray boxes
        primaryTextColor: '#e6edf3',       // Light text
        primaryBorderColor: '#7253ed',     // Purple border (SAPL brand color)
        
        // Secondary elements
        secondaryColor: '#373e47',         // Slightly lighter gray
        secondaryTextColor: '#e6edf3',
        secondaryBorderColor: '#58a6ff',   // Blue accent
        
        // Tertiary elements
        tertiaryColor: '#444c56',
        tertiaryTextColor: '#e6edf3',
        tertiaryBorderColor: '#8b949e',
        
        // Lines and arrows
        lineColor: '#7d8590',              // Visible gray
        textColor: '#e6edf3',
        
        // Main/default colors
        mainBkg: '#2d333b',
        nodeBorder: '#7253ed',
        clusterBkg: '#1c2128',
        clusterBorder: '#444c56',
        
        // Special elements
        edgeLabelBackground: '#1c2128',
        
        // Flowchart specific
        nodeTextColor: '#e6edf3',
        
        // Sequence diagram specific
        actorBkg: '#2d333b',
        actorBorder: '#7253ed',
        actorTextColor: '#e6edf3',
        actorLineColor: '#7d8590',
        signalColor: '#7d8590',
        signalTextColor: '#e6edf3',
        labelBoxBkgColor: '#2d333b',
        labelBoxBorderColor: '#7253ed',
        labelTextColor: '#e6edf3',
        loopTextColor: '#e6edf3',
        noteBorderColor: '#7253ed',
        noteBkgColor: '#373e47',
        noteTextColor: '#e6edf3',
        
        // Grid and background
        gridColor: '#444c56',
        
        // Font
        fontFamily: 'ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, "Liberation Mono", monospace'
      } : {
        // Light mode - clean and professional
        darkMode: false,
        background: '#ffffff',
        
        // Primary elements
        primaryColor: '#eeebff',           // Light purple
        primaryTextColor: '#27262b',       // Dark text
        primaryBorderColor: '#5e41d0',     // Purple border
        
        // Secondary elements
        secondaryColor: '#f9f9fb',
        secondaryTextColor: '#27262b',
        secondaryBorderColor: '#7253ed',
        
        // Tertiary elements
        tertiaryColor: '#fff',
        tertiaryTextColor: '#27262b',
        tertiaryBorderColor: '#8b949e',
        
        // Lines and arrows
        lineColor: '#5e41d0',
        textColor: '#27262b',
        
        // Main/default colors
        mainBkg: '#eeebff',
        nodeBorder: '#5e41d0',
        clusterBkg: '#f9f9fb',
        clusterBorder: '#d0d7de',
        
        // Special elements
        edgeLabelBackground: '#ffffff',
        
        // Flowchart specific
        nodeTextColor: '#27262b',
        
        // Sequence diagram specific
        actorBkg: '#eeebff',
        actorBorder: '#5e41d0',
        actorTextColor: '#27262b',
        actorLineColor: '#5e41d0',
        signalColor: '#5e41d0',
        signalTextColor: '#27262b',
        labelBoxBkgColor: '#eeebff',
        labelBoxBorderColor: '#5e41d0',
        labelTextColor: '#27262b',
        loopTextColor: '#27262b',
        noteBorderColor: '#5e41d0',
        noteBkgColor: '#f9f9fb',
        noteTextColor: '#27262b',
        
        // Grid and background
        gridColor: '#d0d7de',
        
        // Font
        fontFamily: 'ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, "Liberation Mono", monospace'
      }
    });
  }
  
  // Initialize on load
  initMermaid();
  
  // Re-render on theme change
  if (typeof jtd !== 'undefined') {
    const observer = new MutationObserver(() => {
      initMermaid();
      // Re-render all diagrams
      document.querySelectorAll('.mermaid').forEach(el => {
        const graphDefinition = el.textContent;
        el.removeAttribute('data-processed');
        el.innerHTML = graphDefinition;
      });
      mermaid.init(undefined, document.querySelectorAll('.mermaid'));
    });
    
    observer.observe(document.documentElement, {
      attributes: true,
      attributeFilter: ['data-color-mode', 'data-theme']
    });
  }
</script>

<!-- Mermaid Styling -->
<style>
  .mermaid {
    text-align: center;
    margin: 2em 0;
    background: transparent;
  }
  
  .mermaid svg {
    max-width: 100%;
    height: auto;
  }
  
  /* Ensure diagram is visible on dark backgrounds */
  [data-color-mode="dark"] .mermaid svg {
    filter: none;
  }
  
  /* Additional styling for better readability */
  .mermaid .nodeLabel {
    color: inherit;
  }
  
  .mermaid .edgeLabel {
    background-color: transparent;
  }
</style>