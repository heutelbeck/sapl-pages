<!-- Favicon -->
<link rel="icon" href="/assets/sapl_reference_images/favicon.png" type="image/png">

<!-- Matomo Analytics -->
<script type="text/javascript">
    var _paq = window._paq || [];    
    _paq.push(["disableCookies"]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
        var u="//www.ftk.de/statistik/";
        _paq.push(['setTrackerUrl', u+'matomo.php']);
        _paq.push(['setSiteId', '2']);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
        g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
    })();
</script>
<!-- End Matomo Code -->

<!-- Mermaid Diagram Support -->
<script type="module">
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
  
  console.log('[SAPL Mermaid] Starting initialization...');
  
  // Detect current theme (Just the Docs)
  function getCurrentTheme() {
    if (typeof jtd !== 'undefined' && jtd.getTheme) {
      return jtd.getTheme();
    }
    return document.documentElement.getAttribute('data-color-mode') === 'dark' ? 'dark' : 'light';
  }
  
  // Initialize Mermaid with theme
  function initMermaid() {
    const isDark = getCurrentTheme() === 'dark';
    console.log('[SAPL Mermaid] Current theme:', isDark ? 'DARK' : 'LIGHT');
    
    const config = {
      startOnLoad: true,
      theme: 'dark', // Force dark theme
      securityLevel: 'loose',
      logLevel: 'debug',
      flowchart: {
        htmlLabels: true,
        curve: 'basis'
      },
      themeVariables: {
        // EXTREME colors for testing - you'll definitely see if this works
        darkMode: true,
        
        // Primary nodes - BRIGHT CYAN for visibility test
        primaryColor: '#006d7a',
        primaryTextColor: '#ffffff',
        primaryBorderColor: '#00ffff',
        
        // Secondary - BRIGHT PURPLE
        secondaryColor: '#5e41d0',
        secondaryTextColor: '#ffffff',
        secondaryBorderColor: '#ff00ff',
        
        // Tertiary
        tertiaryColor: '#2d333b',
        tertiaryTextColor: '#ffffff',
        tertiaryBorderColor: '#ffff00',
        
        // Lines - BRIGHT GREEN
        lineColor: '#00ff00',
        
        // Text - WHITE
        textColor: '#ffffff',
        
        // Background
        background: '#1a1a1a',
        mainBkg: '#006d7a',
        
        // Borders
        nodeBorder: '#00ffff',
        
        // More specifics
        clusterBkg: '#2d333b',
        clusterBorder: '#00ffff',
        edgeLabelBackground: '#1a1a1a',
        nodeTextColor: '#ffffff',
        
        // Sequence diagram
        actorBkg: '#006d7a',
        actorBorder: '#00ffff',
        actorTextColor: '#ffffff',
        actorLineColor: '#00ff00',
        signalColor: '#00ff00',
        signalTextColor: '#ffffff',
        labelBoxBkgColor: '#006d7a',
        labelBoxBorderColor: '#00ffff',
        labelTextColor: '#ffffff',
        loopTextColor: '#ffffff',
        noteBorderColor: '#00ffff',
        noteBkgColor: '#2d333b',
        noteTextColor: '#ffffff',
        activationBorderColor: '#00ffff',
        activationBkgColor: '#2d333b'
      }
    };
    
    console.log('[SAPL Mermaid] Config:', JSON.stringify(config, null, 2));
    mermaid.initialize(config);
    
    console.log('[SAPL Mermaid] Initialized! Found diagrams:', document.querySelectorAll('.mermaid').length);
  }
  
  // Initialize on load
  initMermaid();
  
  // Re-render on theme change
  if (typeof jtd !== 'undefined') {
    const observer = new MutationObserver(() => {
      console.log('[SAPL Mermaid] Theme changed, re-initializing...');
      initMermaid();
      // Re-render all diagrams
      document.querySelectorAll('.mermaid').forEach(el => {
        const graphDefinition = el.textContent;
        el.removeAttribute('data-processed');
        el.innerHTML = graphDefinition;
      });
      mermaid.init(undefined, document.querySelectorAll('.mermaid'));
    });
    
    observer.observe(document.documentElement, {
      attributes: true,
      attributeFilter: ['data-color-mode', 'data-theme']
    });
  }
</script>

<!-- Mermaid Styling -->
<style>
  .mermaid {
    text-align: center;
    margin: 2em 0;
    background: transparent;
  }
  
  .mermaid svg {
    max-width: 100%;
    height: auto;
  }
</style>